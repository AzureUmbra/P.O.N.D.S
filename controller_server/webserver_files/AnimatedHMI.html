<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Animate Flow Arrow</title>
<script type="text/javascript" src="./web_assets/js/svg.min.js"></script>
<script type="text/javascript" src="./web_assets/js/d3.v4.min.js"></script>


</head>
<body style="padding:10px;font-family:arial">
<center>
<h2> Animation of Flow - Mad Duck Pond </h2>
<center><button id="pausePlayButton" onclick="pausePlayButtonClicked()">Stop Pump</button></center>

<p></p>  This is running animation library <a href="http://svgjs.com/">SVG.js</a> and D3. 

</td>

<td>
<div id="svgDiv" style="background-color:white;width:400px;height:400px;">
<svg id="mySVG" width="400" height="400">
<defs id="arrowDefs">
<marker id="arrowEnd" viewBox="0 0 8000 8000" refX="280" refY="150" markerUnits="strokeWidth" markerWidth="300" markerHeight="300" orient="auto" fill="black" stroke-linejoin="bevel">
<path id="arrowEndPath" stroke="RGB(0,0,0)" stroke-width="5" d="M2 59,293 148,1 243,121 151,Z">
</path>
</marker>
</defs>
<defs id="defsShadow">
<filter id="drop-shadow" height="150%" width="150%">
<fegaussianblur in="SourceAlpha" stdDeviation="5" result="blur"></fegaussianblur>
<feoffset in="blur" dx="5" dy="5" result="offsetBlur"></feoffset>
<femerge>
<femergenode in="offsetBlur"></femergenode>
<femergenode in="SourceGraphic"></femergenode>
</femerge>
</filter>
</defs>
<defs id="pipe3dDefs">
<filter id="pipe3D">
<feflood flood-color="black"></feflood>
<fecomposite operator="out" in2="SourceGraphic"></fecomposite>
<fegaussianblur stdDeviation="6"></fegaussianblur>
<fecomposite operator="atop" in2="SourceGraphic"></fecomposite>
</filter>
</defs>

<path id="pipe" fill="none" fill-opacity="1.0" stroke="#adff2f" stroke-width="25" stroke-opacity="1.0" stroke-linejoin="round" filter="url(#pipe3D)" d="M 185 140 L 363 140 L 363 351 L 257 351 L 257 279 L 33 279 L 33 166 L 185 166 z" type="linear" rightangle="true" pointer-events="visible" rotateangle="0"></path>
<path id="arrowLine1" marker-end="url(#arrowEnd)" fill="none" stroke="black" stroke-width="2" d="M342.1605224609375,140,362.1605224609375,140,363,159.16050720214844">
</path>
<path id="arrowLine2" marker-end="url(#arrowEnd)" fill="none" stroke="black" stroke-width="2" d="M257,331.77947998046875,257,311.77947998046875,257,291.77947998046875">
</path>

<g title="Horizontal Pump" parentid="" nativewidth="154" nativeheight="106" myscale="0.8" transform="matrix(0.8 0 0 0.8 119.9 122.9)" id="process1520095267655" filter="url(#drop-shadow)">
<svg title="Horizontal Pump" class="Pumps" height="106" width="154" viewBox="0 0 154 105.947" nativewidth="154" nativeheight="106" overflow="visible" myscale="1.0">

    <defs>

        <lineargradient x1="0%" y2="0%" x2="100%" y1="0%" id="lg1_219">

            <stop stop-color="#9aa1aa" offset="0"></stop>

            <stop stop-color="#aeb5c0" offset="0.22"></stop>

            <stop stop-color="#dce0e5" offset="0.57"></stop>

            <stop stop-color="#cacfd7" offset="0.84"></stop>

            <stop stop-color="#a7afb9" offset="1"></stop>

        </lineargradient>

        <lineargradient x1="0%" y2="0%" x2="100%" y1="0%" id="lg2_219">

            <stop stop-color="#8f969d" offset="0"></stop>

            <stop stop-color="#d3d8de" offset="0.64"></stop>

            <stop stop-color="#9aa0a8" offset="1"></stop>

        </lineargradient>

        <lineargradient x1="0%" y2="0%" x2="100%" y1="0%" id="lg3_219">

            <stop stop-color="#626974" offset="0"></stop>

            <stop stop-color="#ccd0d5" offset="0.66"></stop>

            <stop stop-color="#5e6670" offset="1"></stop>

        </lineargradient>

        <radialgradient fy="51" r="72.6" id="rg1" cy="51" cx="51" gradientUnits="userSpaceOnUse" fx="51">

            <stop stop-color="#c7cbd1" offset="0"></stop>

            <stop stop-color="#c4c7cd" offset="0.91"></stop>

            <stop stop-color="#d4d8dd" offset="0.74"></stop>

            <stop stop-color="#b6bcc4" offset="0.54"></stop>

        </radialgradient>

    </defs>

    <g transform="translate(1.01,1)">

        <g transform="matrix(-1,0,0,1,74.4,31.2)">

            <path transform="matrix(0,-1,-1,0,68.3,40.6)" id="shape1" fill="url(#lg1_219)" d="M0,0L39.1,0L39.1,68.3L0,68.3L0,0z"></path>

            <path transform="matrix(0,-1,-1,0,74.4,42.9)" id="shape2" fill="url(#lg2_219)" d="M1.4,-0L41.5,-0C42.2,-0,42.9,1.3,42.9,3C42.9,4.7,42.2,6.1,41.5,6.1L1.4,6.1C.6,6.1,0,4.7,0,3C0,1.3,.6,-0,1.4,-0z"></path>

            <path transform="matrix(0,-1,-1,0,70.3,42.7)" id="shape3" fill="url(#lg3_219)" d="M42.5,0C42.4,1.1,41.9,1.9,41.1,1.9L1.4,1.9C.6,1.9,.1,1,0,0C0,0,42.5,0,42.5,0z"></path>

            <path transform="matrix(0,-1,-1,0,74.1,42.2)" id="shape4" fill="white" fill-opacity="0.32" d="M.7,0L40.8,0C41.2,0,41.5,.3,41.5,.6C41.5,.9,41.2,1.1,40.8,1.1L.7,1.1C.3,1.1,0,.9,0,.6C0,.3,.3,0,.7,0z"></path>

        </g>

        <g transform="translate(77.55,0)">

            <path transform="matrix(0,-1,-1,0,68.3,40.7)" id="shape5" fill="url(#lg1_219)" d="M0,0L39.1,0L39.1,68.3L0,68.3L0,0z"></path>

            <path transform="matrix(0,-1,-1,0,74.4,42.9)" id="shape6" fill="url(#lg2_219)" d="M1.4,-0L41.5,-0C42.2,-0,42.9,1.3,42.9,3C42.9,4.7,42.2,6.1,41.5,6.1L1.4,6.1C.6,6.1,0,4.7,0,3C0,1.3,.6,-0,1.4,-0z"></path>

            <path transform="matrix(0,-1,-1,0,70.3,42.7)" id="shape7" fill="url(#lg3_219)" d="M42.5,0C42.4,1.1,41.9,1.9,41.1,1.9L1.4,1.9C.6,1.9,.1,1,0,0C0,0,42.5,0,42.5,0z"></path>

            <path transform="matrix(0,-1,-1,0,74.1,42.2)" id="shape8" fill="white" fill-opacity="0.35" d="M.7,0L40.8,0C41.2,0,41.5,.3,41.5,.6C41.5,.9,41.2,1.1,40.8,1.1L.7,1.1C.3,1.1,0,.9,0,.6C0,.3,.3,0,.7,0z"></path>

        </g>

        <g transform="translate(26.19,1.31)">

            <path transform="matrix(0,-1,-1,0,102.8,102.6)" id="shape9" fill="url(#rg1)" stroke="#d4d6db" stroke-width="0.25" d="M0,51.4C0,23,23,0,51.3,0C79.7,0,102.6,23,102.6,51.4C102.6,79.8,79.7,102.8,51.3,102.8C23,102.8,0,79.8,0,51.4z"></path>

            <path transform="matrix(0,-1,-1,0,94.2,94)" id="shape10" fill="white" fill-opacity="0.27" d="M0,42.7C0,19.1,19.1,0,42.6,0C66.2,0,85.3,19.1,85.3,42.7C85.3,66.3,66.2,85.5,42.6,85.5C19.1,85.5,0,66.3,0,42.7z"></path>

            <path transform="matrix(0,-1,-1,0,85.9,93.9)" id="shape11" fill="white" fill-opacity="0.13" d="M0,34.5C-0.3,13,17.1,0,17.1,0L73.1,63.9C73.1,63.9,62.3,77.3,42.6,77.3C19.1,77.3,0,58.1,0,34.5z"></path>

        </g>

    </g>

</svg>
</g>
</div>

</center>
<script id="myScript">
var MyArrows   //---onload:  MyArrows=SVG.adopt(pipe)  ---

function runArrows()
{
    var duration=4000
    var rotateAngle=1440
    var pathLength=pipe.getTotalLength()
    var arrow2Offset=pipe.getTotalLength()*.33
    MyArrows.animate(duration).during(
    function(pos) //---setter--
    {
            var length=pathLength*pos
            var Pnt0=pipe.getPointAtLength(length) //--start
            var Pnt1=pipe.getPointAtLength(length+20) //--mid---
            var Pnt2=pipe.getPointAtLength(length+40) //---end---
            var d="M"+[Pnt0.x,Pnt0.y,Pnt1.x,Pnt1.y,Pnt2.x,Pnt2.y].toString()
            arrowLine1.setAttribute("d",d)

        if(length<(pathLength-arrow2Offset))
        {
            var Pnt0=pipe.getPointAtLength(length+arrow2Offset) //--start
            var Pnt1=pipe.getPointAtLength(length+20+arrow2Offset) //--mid---
            var Pnt2=pipe.getPointAtLength(length+40+arrow2Offset) //---end---
            var d="M"+[Pnt0.x,Pnt0.y,Pnt1.x,Pnt1.y,Pnt2.x,Pnt2.y].toString()
            arrowLine2.setAttribute("d",d)
        }
        else if(length>=(pathLength-arrow2Offset))
        {
            var myLength=length-arrow2Offset
            var Pnt0=pipe.getPointAtLength(myLength-arrow2Offset) //--start
            var Pnt1=pipe.getPointAtLength(myLength+20-arrow2Offset) //--mid---
            var Pnt2=pipe.getPointAtLength(myLength+40-arrow2Offset) //---end---
            var d="M"+[Pnt0.x,Pnt0.y,Pnt1.x,Pnt1.y,Pnt2.x,Pnt2.y].toString()
            arrowLine2.setAttribute("d",d)
        }
        Impeller.setAttribute("transform","rotate("+(rotateAngle*pos)+" "+cx+" "+cy+" )")


    })
    .after(function(){
        runArrows()
    })
}

function pausePlayButtonClicked()
{
    if(pausePlayButton.innerHTML=="Stop Pump")
    {
        MyArrows.pause()
        pausePlayButton.innerHTML="Start Pump"
        shape4.setAttribute("fill","crimson")
        shape8.setAttribute("fill","crimson")
        shape10.setAttribute("fill","crimson")
        shape11.setAttribute("fill","crimson")
        pipe.setAttribute("stroke","#ff4500")
    }
    else
    {
        MyArrows.play()
        pausePlayButton.innerHTML="Stop Pump"
        shape4.setAttribute("fill","white")
        shape8.setAttribute("fill","white")
        shape10.setAttribute("fill","white")
        shape11.setAttribute("fill","white")
        pipe.setAttribute("stroke","#adff2f")
    }
}
//==============Impeller==============
//--onload---
//---impeller rotate center point---
var cx;
var cy;
function placeAsImpeller()
{
    var fontSize=105;
   // var unicode="273D";
   var unicode="002B"
    var code = parseInt(unicode, 16);
    var icon = d3.select("#mySVG").append("text")
    .attr("id", "Impeller")
    .attr("x", 183)
    .attr("y", 153)
    .attr("text-anchor", "middle")
    .attr("font-size", fontSize)
    .attr("font-family", "Arial Unicode MS")
    .attr("dy",fontSize/2-4)
    .attr("stroke-width", 2)
    .attr("fill", "green")
    .attr("stroke", "black")
    .text(String.fromCharCode(code));
    // ---get rotate center point---
   
    var bb=Impeller.getBBox();
    cx=bb.x+.5*bb.width;
    cy=bb.y+.5*bb.height;
}


</script>
<script>
document.addEventListener("onload",init(),false)
function init()
{
    placeAsImpeller();
    MyArrows=SVG.adopt(pipe);
    runArrows();
}
</script>
